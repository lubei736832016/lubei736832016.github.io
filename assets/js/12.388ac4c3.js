(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{437:function(s,t,n){"use strict";n.r(t);var a=n(0),e=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("Boxx"),s._v(" "),t("h1",{attrs:{id:"nginx-处理跨域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx-处理跨域"}},[s._v("#")]),s._v(" Nginx 处理跨域")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 配置 nginx 跨域 ")]),s._v("\nlocation "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    rewrite "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("$1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//所有对后端的请求加一个api前缀方便区分真正访问的时候移除这个前缀")]),s._v("\n    add_header "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Origin'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设置请求头")]),s._v("\n    add_header "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Methods'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GET, POST, OPTIONS'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设置请求跨域的方法")]),s._v("\n    proxy_pass "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://47.110.91.18:8090'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//设置代理的服务器地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h2",{attrs:{id:"先介绍几个nginx命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#先介绍几个nginx命令"}},[s._v("#")]),s._v(" 先介绍几个nginx命令")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("打开nginx.conf文件")]),s._v(" "),t("p",[t("code",[s._v("/usr/local/etc/nginx/nginx.conf")])])]),s._v(" "),t("li",[t("p",[s._v("重新加载配置|重启|停止|退出 nginx")]),s._v(" "),t("p",[t("code",[s._v("nginx -s reload|reopen|stop|quit")])])]),s._v(" "),t("li",[t("p",[s._v("打开nginx服务")]),s._v(" "),t("p",[t("code",[s._v("nginx")])])])]),s._v(" "),t("h2",{attrs:{id:"上code-配置nginx-conf的文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#上code-配置nginx-conf的文件"}},[s._v("#")]),s._v(" 上code：配置nginx.conf的文件")]),s._v(" "),t("blockquote",[t("p",[s._v("以下是nginx.conf文件里的serve部分")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("server {    \n    # 配置服务地址    \n    listen       9000;    \n    server_name  localhost;    \n    # 访问根路径，返回前端静态资源页面    \n    location / {        # 前端代码服务地址        proxy_pass http://localhost:8000/;  \n    #前端项目开发模式下，node开启的服务器，根路径下可打开index.html    }    \n    # 最简单的API代理配置    # 约定：所有不是根路径下的资源，都是api接口地址。则可代理如下    \n    location /* {        \n    # API 服务地址        \n    proxy_pass http://www.serverA.com;\n    #将真正的请求代理到API 服务地址,即真实的服务器地址，ajax的url为/user/1将会访问\t\t\t\t\t\thttp://www.serverA.com/user/1    \n    }    \n    # 需要更改rewrite 请求路径的配置    \n    location /api/ {        \n    rewrite ^/api/(.*)$ /$1 break;#所有对后端的请求加一个api前缀方便区分，真正访问的时候移除这个前缀 \n    # API Server       \n    proxy_pass http://www.serverA.com; #将真正的请求代理到serverA,即真实的服务器地址，ajax的url为/api/user/1的请求将会访问\t\t\t\t\t\n    http://www.serverA.com/user/1  \n    \n    }    \n    error_page   500 502 503 504  /50x.html;    \n    location = /50x.html {        root   html;    \n}}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("ul",[t("li",[s._v("配置好nginx.config后，做以下操作。")])]),s._v(" "),t("ol",[t("li",[s._v("启动nginx服务。终端执行："),t("code",[s._v("nginx")])]),s._v(" "),t("li",[s._v("前端项目，index.html同级目录起服务，监听8000端口。自然你可以通过http://localhost:8000访问到页面。但是同时，由于访问nginx服务http://localhost:9000的地址，被代理到了http://localhost:8000地址。所以访问http://localhost:9000，也可以访问到此index.html页面。")]),s._v(" "),t("li",[s._v("项目中，所有接口地址为/*或者为http:localhost:9000/*的都会被代理到http://www.serverA.com/*去访问。从而实现本地开发环境下跨域请求线上http://www.serverA.com的接口。例如ajax的url是/api/user/1，经过代理后发起的请求url是http://www.serverA.com/api/user/1，达到目的，且没有跨域")])]),s._v(" "),t("h2",{attrs:{id:"所有请求-nginx-请求跨域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#所有请求-nginx-请求跨域"}},[s._v("#")]),s._v(" 所有请求 nginx 请求跨域")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    add_header "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Origin'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    add_header "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Methods'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GET, POST, OPTIONS, DELETE, PUT'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    add_header "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Headers'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'X-Requested-With, Content-Type, Origin, Authorization, Accept, Client-Security-Token'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("$request_method "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'OPTIONS'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        add_header "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Origin'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        add_header "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Methods'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GET, POST, OPTIONS, DELETE, PUT'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        add_header "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Headers'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'X-Requested-With, Content-Type, Origin, Authorization, Accept, Client-Security-Token'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])])],1)}),[],!1,null,null,null);t.default=e.exports}}]);